---
title: "ANOVA & Experimental Groups Homework"
author: "Tim Hulak"
output:
  html_document:
    df_print: paged
---

I produced the material below with no assistance

# Exercises 1-7 on pages 117 and 118 of *Reasoning with Data: An Introduction to Traditional and Bayesian Statistics Using R*

1. The data sets package (installed in R by default) contains a data set called InsectSprays  that shows the results of an experiment with six different kinds of insecticide. For each  kind of insecticide, n = 12 observations were conducted. Each observation represented the count of insects killed by the spray. In this experiment, what is the dependent variable (outcome) and what is the independent variable? What is the total number  of observations?  
```{r}
data(InsectSprays)
head(InsectSprays)
```

```{r}
dim(InsectSprays)
```

```{r}
summary(InsectSprays)
```


**Answer**: The *count* variable is the dependent variable (outcome) and the independent variable is the *spray* variable. In other words, after some analysis, we can predict the number of insects killed by the spray using the *spray* type/label. There are **72** observations in this dataset (12 observations for each of the *sprays*).  


---


2. After running the aov() procedure on the InsectSprays data set, the “Mean Sq” for spray  is 533.8 and the “Mean Sq” for Residuals is 15.4. Which one of these is the between-groups variance and which one is the within-groups variance? Explain your answers  briefly in your own words.  
```{r}
aov(count ~ spray, data=InsectSprays)
```

```{r}
sprayAOV <- aov(count ~ spray, data=InsectSprays)
summary(sprayAOV)
```

**Answer**:  The p-value on the F-tests is **0.00000000000000022** and has surpassed the traditional 0.05 level of alpha and is therefore statistically significant (this can also be seen by the 3 stars next to the value in the summary output). We must reject the null hypothesis based on the analysis. The *spray* Mean Sq value of **533.8** is the *between-groups variance* and the *Residuals* value of **15.4** is the *within-groups variance*. The *spray* is the predictor where as the *Residuals* can be thought of as the errors. 



---

3. Based on the information in question 2 and your response to that question, calculate an  F-ratio by hand or using a calculator. Given everything you have earned about F-ratios,  what do you think of this one? Hint: If you had all the information you needed for a Null  Hypothesis Significance Test, would you reject the null? Why or why not?  
```{r}
between_group_variance <- 533.8
within_groups_variance <- 15.4

f_ratio <- between_group_variance/within_groups_variance

f_ratio
```
**Answer**: The F-ratio in this case is **34.66234**. Any F-ratio that is substantially  larger than **1.0** is considered possible evidence that at least one of the groups is from a population with a different mean. **34.66234** is quite a bit larger than **1**, we would reject the null. 


---


4. Continuing with the InsectSprays example, there are six groups where each one has n  = 12 observations. Calculate the degrees of freedom between groups and the degrees  of freedom within groups. Explain why the sum of these two values adds up to one less  than the total number of observations in the data set. 
```{r}
# Get the number of unique observations
unique_length <- length(unique(InsectSprays$spray))

# Get total number of observations
observations <- length(InsectSprays$count)

# Subtract 1 from the length to get the between-groups degrees of freedom
spray_df <- unique_length - 1

# Subtract the spray degrees of freedom from the total number of observations minus 1 to get the Residual degrees of freedom

residual_df <- (observations - 1) - spray_df

print(spray_df)
print(residual_df)

```


**Answer**: There are **6** unique categories in the dataset (*A,B,C,D,E,F*). You calculate the *degrees of freedom* by subtracting **1** from the number of categories, therefore there are **5 degrees of freedom** for the *spray*. The *residual degrees of freedom* is calculated by subtracting **1** from total number of observations (in this case, there are **72** total observations) and then subtracting the *between-groups* degrees of freedom: 72 observations - 1 = 71. 71 - 5 between-groups degrees of freedom = **66 Residual degrees of freedom**. 


---


5. Use R or R-Studio to run the aov() command on the InsectSprays data set. You will  have to specify the model correctly using the “~” character to separate the dependent  variable from the independent variable. Place the results of the aov() command into a  new object called insectResults. Run the summary() command on insectResults and  interpret the results briefly in your own words. As a matter of good practice, you should  state the null hypothesis, the alternative hypothesis, and what the results of the null  hypothesis significance test lead you to conclude.  
```{r}
insectResults <- aov(count ~ spray, data=InsectSprays)
summary(insectResults)
```


**Answer**: The *null hypothesis* is that there is no difference in the means of the populations. The *alternative hypothesis* is that there is a difference in the means of populations. The p-value is less than 0.05, therefore we must reject the null hypothesis based on the analysis

  - **Df**: degrees of freedom, which is how many elements are free to vary after subtracting 1 from the number of observations.   
  - **Sum Sq**: A measure of variability or deviation from the mean 
  - **Mean Sq**: The same thing as variance. This is calculated by dividing the Sum Sq by Df.   
  - **F value**: This is the F ratio, which is calculated by dividing the Mean Sq of the between-group by the Mean Sq of the within-group
  - **Pr(>F)**: This is the p-value of the test and helps determine statistical significance of the test. 


---


6. Load the BayesFactor package and run the anovaBF() command on the InsectSprays  data set. You will have to specify the model correctly using the “~” character to separate the dependent variable from the independent variable. Produce posterior distributions with the posterior() command and display the resulting HDIs. Interpret the results  briefly in your own words, including an interpretation of the BayesFactor produced by the grouping variable. As a matter of good practice, you should state the two hypotheses that are being compared. Using the rules of thumb offered by Kass and Raftery  (1995), what is the strength of this result?  
```{r}
library(BayesFactor)

spray_bayes_out <- anovaBF(count ~ spray, data=InsectSprays)
mcmcOut <- posterior(spray_bayes_out,iterations = 10000)
plot(mcmcOut[,'mu'])
plot(mcmcOut[,'spray-A'])
plot(mcmcOut[,'spray-B'])
plot(mcmcOut[,'spray-C'])
plot(mcmcOut[,'spray-D'])
plot(mcmcOut[,'spray-E'])
plot(mcmcOut[,'spray-F'])
```

```{r}
summary(mcmcOut)
```

```{r}
boxplot(as.matrix(mcmcOut[,2:7]))
```

```{r}
spray_bayes_out
```


**Answer**: The *null hypothesis* is that the spray has no effect on the count. The *alternative hypothesis* is that the spray has an effect on the count. The odds are approximately **1.506706:1**. error!). According to the rules of thumb provided by  Kass and Raftery (1995), any odds ratio in excess of 150:1 is considered very Strong evidence. Therefore we must reject the null hypothesis


---


7. In situations where the alternative hypothesis for an ANOVA is supported and there  are more than two groups, it is possible to do post-hoc testing to uncover which pairs  of groups are substantially different from one another. Using the InsectSprays data,  conduct a t-test to compare groups C and F (preferably a Bayesian t-test). Interpret the  results of this t-test. 
```{r}
library(BEST)
# Slice the data
CandF <- InsectSprays[InsectSprays$spray=="C" | InsectSprays$spray=="F",]

sprayC <- InsectSprays[InsectSprays$spray=="C",1]
sprayF <- InsectSprays[InsectSprays$spray=="F",1]

obs <-data.frame("C" = sprayC, ".F" = sprayF)
plot(BESTmcmc(InsectSprays[InsectSprays$spray=="C",1],
              InsectSprays[InsectSprays$spray=="F",1]))
sprayBFOut <- anovaBF(count ~ spray, data=CandF)
summary(sprayBFOut)
```
**Answer**: The entire distribution is below **0**, as seen in the **100% < 0 < 0%**. There is also a 95% chance of the mean differences being between **-18.9** and **-10**. In addition, the most likely mean difference is **-14.5** It appears that *spray-F* performes better than *spray-C*.


---

